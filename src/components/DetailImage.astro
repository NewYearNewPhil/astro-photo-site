---
import { Image } from "astro:assets";

const { image, prevImage, nextImage } = Astro.props as any;
---

<div
    transition:animate="fade"
    class="w-screen h-screen flex justify-center items-center"
>
    <Image
        class="max-w-screen max-h-screen w-auto h-auto absolute"
        widths={[360, 720, 1024, 1920]}
        sizes="(max-width: 360px) 360px, (max-width: 720px) 720px, (max-width: 1024px) 1024px, (max-width: 1920px) 1920px"
        src={image.data.src}
        alt={image.data.title}
    />
    <div class="fixed bottom-4 flex justify-center w-full">
        <div transition:animate="none" class="join bg-base-200">
            {
                prevImage && (
                    <a href={`../${prevImage.slug}/`}>
                        <button class="join-item btn">«</button>
                    </a>
                )
            }
            <button class="join-item btn">{image.data.title}</button>
            {
                nextImage && (
                    <a href={`../${nextImage.slug}/`}>
                        <button class="join-item btn">»</button>
                    </a>
                )
            }
        </div>
    </div>
</div>

<script is:inline data-astro-rerun define:vars={{ prevImage, nextImage }}>
    // changed from https://stackoverflow.com/a/23230280

    document.addEventListener("touchstart", handleTouchStart, true);
    document.addEventListener("touchmove", handleTouchMove, true);

    document.addEventListener("astro:before-swap", evt => {
        document.removeEventListener("touchstart", handleTouchStart, true);
        document.removeEventListener("touchmove", handleTouchMove, true);
    })

    let xDown = undefined;
    let yDown = undefined;

    function handleTouchStart(evt) {
        const firstTouch = evt.touches[0];
        xDown = firstTouch.clientX;
        yDown = firstTouch.clientY;
    }

    function handleTouchMove(evt) {
        if (!xDown || !yDown) {
            return;
        }

        var xUp = evt.touches[0].clientX;
        var yUp = evt.touches[0].clientY;

        var xDiff = xDown - xUp;
        var yDiff = yDown - yUp;

        if (Math.abs(xDiff) > Math.abs(yDiff)) {
            if (xDiff > 0) {
                /* right swipe */
                if (nextImage) {
                    window.location.assign(`../${nextImage.slug}/`);
                }
            } else {
                /* left swipe */
                if (prevImage) {
                    window.location.assign(`../${prevImage.slug}/`);
                }
            }
        }

        xDown = undefined;
        yDown = undefined;
    }
</script>
